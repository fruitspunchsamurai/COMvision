#include <highgui.h>
#include <iostream>
#include <vector>
#include <stdio.h>
#include <opencv2/imgproc/imgproc.hpp>
#include <opencv2/highgui/highgui.hpp>
#include <opencv2/opencv.hpp>
#include <boost/lexical_cast.hpp> 
 
int g_slider_position_h1 = 0;
int g_slider_position_s1 = 0;
int g_slider_position_v1 = 0;
 
int g_slider_position_h2 = 255;
int g_slider_position_s2 = 255;
int g_slider_position_v2 = 255;
 
int g_slider_position_smooth = 0;
 
int g_slider_position_cam = 1 ;
 
Mat src_image;
Mat hsv_image;
 
Scalar(hsv_min) = Scalar(120, 120, 120, 120);
Scalar(hsv_max) = Scalar(134, 134, 134, 134);
 
 
int main(  )
{
 
	int key = 0;
	
	src_image = imread( imageName, 1 );
	
	src_image = cvCreateImage(cvSize(320,240), 8, 3);
	hsv_image = cvCreateImage(cvSize(320,240), 8, 3);
	Mat hsv_filt  = cvCreateImage( cvSize(320, 240), IPL_DEPTH_8U , 1);
	Mat hsv_smooth  = cvCreateImage( cvSize(320,240), IPL_DEPTH_8U , 1);
	
	NamedWindow( "src",0);
	NamedWindow( "filterd",1);
		
	while( key != 27)
	{		
		
		CreateTrackbar("Hue 1","src",&g_slider_position_h1,180,NULL);
		CreateTrackbar("Sat 1","src",&g_slider_position_s1,255,NULL);
		CreateTrackbar("Val 1","src",&g_slider_position_v1,255,NULL);
	
		CreateTrackbar("Hue 2","src",&g_slider_position_h2,180,NULL);
		CreateTrackbar("Sat 2","src",&g_slider_position_s2,255,NULL);
		CreateTrackbar("Val 2","src",&g_slider_position_v2,255,NULL);
		
		CreateTrackbar("Smooth","src",&g_slider_position_smooth,100,NULL);
		
		CreateTrackbar("Cam ","src",&g_slider_position_cam,1,NULL);
		
		
		hsv_min.val[0] = g_slider_position_h1;
  		hsv_min.val[1] = g_slider_position_s1;
  		hsv_min.val[2] = g_slider_position_v1;
  		
  		hsv_max.val[0] = g_slider_position_h2;
  		hsv_max.val[1] = g_slider_position_s2;
  		hsv_max.val[2] = g_slider_position_v2;
		
		src_image = imread( imageName, 1);
		cvtColor(src_image, hsv_image, CV_BGR2HSV);
		InRangeS (hsv_image, hsv_min, hsv_max, hsv_filt);
		
		if(g_slider_position_smooth == 0 )
		{
			imshow("src",src_image);
			imshow("filterd",hsv_filt);
		}
		else if(g_slider_position_smooth%2 != 0 )
		{
			GaussianBlur( hsv_filt, hsv_smooth, CV_MEDIAN,g_slider_position_smooth, 0, 0, 0 );
			imshow("src",src_image);
			imshow("filterd",hsv_smooth);
		}
		else
		{
			GaussianBlur( hsv_filt, hsv_smooth, CV_MEDIAN,g_slider_position_smooth+1, 0, 0, 0 );
			imshow("src",src_image);
			imshow("filterd",hsv_smooth);
		
		}
		
		if(g_slider_position_cam == 0)
		{
			/*
			cvReleaseCapture( &capture);
			while((g_slider_position_cam == 0)&& key != 27) key = cvWaitKey(100);
			capture = cvCaptureFromCAM(0);
			*/
		}
		
		else if(g_slider_position_cam == 1)key = cvWaitKey( 30 );
	}	
	
return 1;
}
